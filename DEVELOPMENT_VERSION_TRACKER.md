Development Version Tracker - Mainsystem PHP Project
This document tracks the development progress, versions, and notable changes for the Mainsystem PHP project.

Version 0.14.0 - Site-Wide Time Formatting (2025-06-02)
Date: 2025-06-02

Features Implemented:

Config.php Enhancements:
Set a default PHP timezone using date_default_timezone_set().
Defined DEFAULT_TIME_FORMAT constant.
Added get_site_time_format() helper function:
Retrieves 'site_time_format' option from the database (via OptionModel).
Falls back to DEFAULT_TIME_FORMAT if the option is not set.
Includes static caching for performance.
Added format_datetime_for_display($datetimeString, $customFormat = null) helper function:
Takes a datetime string and an optional custom format.
Formats the string using the site's configured time format (via get_site_time_format()) or the custom format if provided.
Includes basic error handling for invalid date strings.

Admin Site Settings (AdminController.php & site_settings.php view):
AdminController::siteSettings():
Added 'site_time_format' to the $manageableOptions array.
Defined a list of common PHP date/time format strings (e.g., 'Y-m-d H:i:s', 'm/d/Y h:i A') as selectable options, with examples generated by date().
The default value for this setting uses DEFAULT_TIME_FORMAT from config.php.
app/views/admin/site_settings.php:
Updated to render a dropdown menu for the 'Site Time Format' setting, populated with the predefined formats and their examples.

View Updates for Consistent Time Display:
The format_datetime_for_display() helper function was applied to all relevant views to ensure consistent time formatting:
app/views/admin/users.php: Formatted user_registered.
app/views/admin/roles_list.php: Formatted created_at.
app/views/admin/departments.php: Formatted created_at.
app/views/openoffice/rooms_list.php: Formatted object_modified.
app/views/openoffice/reservations_list.php (Admin): Formatted reservation_start_datetime, reservation_end_datetime, and object_date (requested on).
app/views/openoffice/my_reservations_list.php (User): Formatted reservation_start_datetime, reservation_end_datetime, and object_date (requested on).

Dashboard Calendar (DashboardController.php & dashboard/index.php view):
DashboardController.php:
Modified to use format_datetime_for_display() to pre-format formattedStartTime and formattedEndTime for calendar event tooltips, ensuring they respect the site setting.
app/views/dashboard/index.php:
The FullCalendar eventDidMount function now uses these pre-formatted formattedStartTime and formattedEndTime from extendedProps for the tooltip display.

Key Changes & Fixes:
Introduced a global site setting for administrators to control how dates and times are displayed.
Ensured consistent date and time formatting across various admin and user-facing lists.
Updated dashboard calendar tooltips to reflect the chosen site time format.

To-Do / Next Steps (Examples for Time Formatting):
Consider adding a 'Site Timezone' setting in the admin panel.
Ensure all date/time inputs (e.g., reservation form) are handled correctly with respect to timezones if they become configurable.

Version 0.13.0 - Room Reservation Conflict Resolution (2025-06-02)
Date: 2025-06-02

Features Implemented:

ObjectModel.php Enhancements:
Added getConflictingReservations($roomId, $startTime, $endTime, $statuses = ['approved'], $excludeReservationId = null) method:
Constructs a SQL query to find reservations in a specific room that overlap with a given time slot and have specified statuses.
The core conflict logic is: (existing_start < new_end) AND (existing_end > new_start).
Allows excluding a specific reservation ID from the check.
Returns an array of conflicting reservation objects or false on error.

OpenOfficeController.php Updates for Conflict Handling:
createreservation() method:
Before creating a new 'pending' reservation, it now calls getConflictingReservations() to check if the requested time slot for the room conflicts with any existing 'approved' reservations.
If a conflict with an 'approved' reservation is found, an error message is displayed, and the new reservation is not created.
approvereservation() method:
Before changing a 'pending' reservation to 'approved', it first checks for conflicts with other 'approved' reservations for the same room and time slot. If a conflict exists, the approval is blocked.
If no conflicts with other 'approved' reservations exist and the current reservation is successfully approved:
It then calls getConflictingReservations() again to find any 'pending' reservations for the same room that overlap with the newly approved time slot.
All such overlapping 'pending' reservations are automatically updated to 'denied' status.
A message is appended to the admin's success notification, indicating how many pending requests were automatically denied.
deleteRoom() method:
Added a check to prevent deletion of a room if it has any existing reservations.

Key Changes & Fixes:
Implemented a system to prevent double-booking of rooms for approved reservations.
Automated the denial of pending requests that conflict with a newly approved reservation.
Improved data integrity by preventing deletion of rooms with active or pending reservations.

Version 0.12.0 - Dashboard Calendar for Room Reservations (2025-06-02)
Date: 2025-06-02

Features Implemented:

Layout Updates (Header & Footer):
app/views/layouts/header.php:
Added FullCalendar library (JS and CSS) via CDN.

DashboardController.php (index() method):
Instantiated ObjectModel and UserModel.
Fetched room reservations with 'pending' or 'approved' status using a new getObjectsByConditions() method in ObjectModel.
Processed reservations into a JSON array suitable for FullCalendar events.

ObjectModel.php:
Added new method getObjectsByConditions($objectType, array $conditions, array $args).

Dashboard View (app/views/dashboard/index.php):
Added a <div> with id="reservationCalendar" to serve as the calendar container.
Included JavaScript to initialize FullCalendar.
Implements eventDidMount to add Bootstrap tooltips on event hover.
Added a simple legend below the calendar for event colors.

Key Changes & Fixes:
Enhanced dashboard with a visual calendar for room reservations.
Improved data fetching in ObjectModel.

Version 0.11.0 - Room Reservation System (Basic) (2025-06-02)
Date: 2025-06-02

Features Implemented:
Config Updates, OpenOfficeController.php (Reservation Logic), New Views for Reservations, Layout and View Updates, Object Model Usage for reservations.

Version 0.10.0 - Dynamic Role Management (CRUD) (2025-05-30)
Date: 2025-05-30

Features Implemented:
Database Schema for Roles, RoleModel.php, config.php Updates, AdminController.php (Role CRUD Actions), Admin Views for Role Management, UI Updates for role management.

Version 0.9.1 - Restricted Admin Role Permissions Editing (2025-05-30)
Date: 2025-05-30

Features Implemented:
AdminController.php - roleAccessSettings() Safeguard, app/views/admin/role_access_settings.php - UI Restriction for 'Admin' Role.

Version 0.9.0 - Editable Role Permissions (2025-05-30)
Date: 2025-05-30

Features Implemented:
Database-driven role-permission mapping, RolePermissionModel.php, config.php updated for userHasCapability(), AdminController::roleAccessSettings() updated to save changes, role_access_settings.php view made into an editable form.

Version 0.8.0 - Role Access Settings Display (2025-05-30)
Date: 2025-05-30

Features Implemented:
Capability Definitions (config.php), AdminController.php capability checks & roleAccessSettings() (read-only), role_access_settings.php view (read-only), UI Links for Role Access Settings.

Version 0.7.0 - Site Settings Module (2025-05-30)
Date: 2025-05-30

Features Implemented:
OptionModel.php, AdminController::siteSettings(), site_settings.php view, UI links.

Version 0.6.0 - Breadcrumb Navigation (2025-05-30)
Date: 2025-05-30

Features Implemented:
Breadcrumb helper function and integration.

Version 0.5.0 - Department Module & User Assignment (2025-05-30)
Date: 2025-05-30

Features Implemented:
Database schema & DepartmentModel.php for departments, Controller & Model updates for department management and user assignment, Admin views for department CRUD and user-department assignment.

Version 0.4.0 - Role-Based Access Control (RBAC) - Basic (2025-05-30)
Date: 2025-05-30

Features Implemented:
user_role column in users table, Model, Controller, and View updates for basic role management.

Version 0.3.0 - Admin User Management (2025-05-30)
Date: 2025-05-30

Features Implemented:
Full CRUD for users in Admin Panel.

Version 0.2.0 - Administrator Module (2025-05-30)
Date: 2025-05-30

Features Implemented:
Basic AdminController and admin dashboard view.

Version 0.1.0 - Initial Setup & Login System (2025-05-30)
Date: 2025-05-30

Features Implemented:
Core MVC structure, DB connection, routing, login system, basic dashboard, Bootstrap & jQuery.

Version X.Y.Z (Future Version)
Date: